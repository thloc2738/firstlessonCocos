{"version":3,"sources":["playerControl.js"],"names":["Emitter","require","cc","Class","extends","Component","properties","isTouch","player","Node","_tagOther","countTime","delayAnim","walkSound","AudioClip","shootSound","onLoad","systemEvent","on","SystemEvent","EventType","KEY_DOWN","left_Move","right_Move","jump_move","shooting_move","target","getComponent","setAnimation","manager","director","getCollisionManager","enabled","enabledDebugDraw","setEventListener","entry","event","data","log","name","current","audioEngine","play","keyCode","macro","KEY","up","instance","emit","left","right","space","onCollisionEnter","other","self","console","tag","jump","shoot","scaleX","addAnimation","onCollisionStay","onCollisionExit","animJump","seq","sequence","moveBy","runAction","update","dt","node","x","action","delayTime","callFunc"],"mappings":"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","file":"playerControl.js","sourceRoot":"../../../../assets/Script","sourcesContent":["const Emitter = require('registerEvent');\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        isTouch: false,\n        player: cc.Node,\n        _tagOther: 1,\n        countTime: 0,\n        delayAnim: false,\n        walkSound: cc.AudioClip,\n        shootSound: cc.AudioClip,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad() {\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.left_Move, this);\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.right_Move, this);\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.jump_move, this);\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.shooting_move, this);\n        let target = this.player.getComponent(\"sp.Skeleton\");\n        target.setAnimation(0, \"run\", true);\n        let manager = cc.director.getCollisionManager();\n        manager.enabled = true;\n        manager.enabledDebugDraw = true;\n        this.player.getComponent(\"sp.Skeleton\").setEventListener((entry, event) => {\n            const { data } = event;\n            cc.log(data.name);\n            this.current = cc.audioEngine.play(this.walkSound, false, 1);\n        });\n\n    },\n    jump_move(event) {\n        switch (event.keyCode) {\n            case cc.macro.KEY.up:\n                Emitter.instance.emit(\"MOVE_JUMP\");\n                break;\n        }\n    },\n    left_Move(event) {\n        switch (event.keyCode) {\n            case cc.macro.KEY.left:\n                Emitter.instance.emit(\"MOVE_LEFT\");\n                break;\n        }\n    },\n    right_Move(event) {\n        switch (event.keyCode) {\n            case cc.macro.KEY.right:\n                Emitter.instance.emit(\"MOVE_RIGHT\");\n                break;\n        }\n    },\n    shooting_move(event) {\n        switch (event.keyCode) {\n            case cc.macro.KEY.space:\n                Emitter.instance.emit(\"SHOOTING\");\n                break;\n        }\n    },\n    onCollisionEnter: function (other, self) {\n        console.log('on collision enter');\n        if (other.tag == 0 && self.tag == 0) {\n            this.jump();\n        }\n        if (other.tag == 1 && self.tag == 1) {\n\n            this.delayAnim = true;\n            cc.audioEngine.play(this.shootSound, false, 1);\n            this.shoot();\n\n        }\n        if (other.tag == 2 && self.tag == 0) {\n            this.player.scaleX *= -1;\n        }\n\n\n\n\n    },\n    shoot() {\n        let target = this.player.getComponent(\"sp.Skeleton\");\n        target.setAnimation(0, \"shoot\", false);\n        target.addAnimation(0, \"run\", true);\n    },\n    onCollisionStay: function (other, self) {\n    },\n    onCollisionExit: function (other, self) {\n    },\n    jump() {\n        this.animJump();\n        if (this.player.scaleX >= 0) {\n            var seq = cc.sequence(cc.moveBy(0.4, 20, 20), cc.moveBy(0.4, 20, -20))\n        }\n        else {\n            var seq = cc.sequence(cc.moveBy(0.4, -20, 20), cc.moveBy(0.4, -20, -20))\n        }\n        this.player.runAction(seq);\n    },\n    animJump() {\n        let target = this.player.getComponent(\"sp.Skeleton\");\n        target.setAnimation(0, \"jump\", false);\n        target.addAnimation(0, \"run\", true);\n        this.isTouch = false;\n    },\n    update(dt) {\n        if (!this.delayAnim) {\n            if (this.isTouch == false) {\n                if (this.node.scaleX >= 0) {\n                    this.node.x += 70 * dt;\n                }\n                else {\n                    this.node.x -= 70 * dt;\n                }\n            }\n        } else {\n            let action = cc.sequence(cc.delayTime(0.5), cc.callFunc(() => {\n                this.delayAnim = false;\n            }));\n            this.player.runAction(action);\n        }\n\n    },\n});\n"]}